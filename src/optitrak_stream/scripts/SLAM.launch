<launch>
  <!-- Launch MAVROS node -->
  <node name="mavros" pkg="mavros" type="mavros_node" output="screen">
    <!-- Configure MAVROS parameters -->
    <param name="fcu_url" type="string" value="udp://:14540" />
    <param name="gcs_url" type="string" value="" />
    <param name="target_system" type="int" value="1" />
    <param name="target_component" type="int" value="1" />
  </node>

  <!-- Node for Raspberry Pi Camera -->
  <node pkg="raspicam_node" type="raspicam_node" name="raspicam_node" output="screen">
      <!-- Node parameters -->
      <param name="camera_name" type="string" value="raspicam"/>
      <param name="image_width" type="int" value="640"/>
      <param name="image_height" type="int" value="480"/>        
      <param name="camera_info_url" type="string" value="file:///home/ros/camera_info/raspicam.yaml"/>
      <param name="framerate" type="double" value="30.0"/>
      <param name="horizontal_flip" type="bool" value="false"/>
      <param name="vertical_flip" type="bool" value="false"/>

      <!-- Remap topics if needed -->
      <!-- <remap from="image_raw" to="camera/image_raw"/> -->
      <!-- <remap from="camera_info" to="camera/camera_info"/> -->
  </node>

  <!-- Launch RTAB-Map Node for SLAM -->
  <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen">
    <!-- Configure RTAB-Map parameters -->
    <param name="database_path" type="string" value="/path/to/rtabmap.db" />
    <param name="RGBD/Enabled" type="bool" value="true" />
    <param name="RGBD/LocalUpdate" type="bool" value="true" />
    <remap from="rgb/image_raw" to="/stereo/left/image_rect_color" />
    <remap from="depth/image_rect_raw" to="/stereo/depth_registered" />
    <remap from="camera_info" to="/stereo/left/camera_info" />
  </node>

  <!-- Launch Message Filter Node -->
  <node name="message_filter" pkg="message_filters" type="message_filter_node" output="screen">
    <!-- Configure Message Filter parameters -->
    <param name="timeout" type="double" value="0.5" />
    <param name="queue_size" type="int" value="10" />
    <remap from="/input_topic_1" to="/stereo/left/image_rect_color" />
    <remap from="/input_topic_2" to="/stereo/depth_registered" />
    <!-- Add more remaps if needed -->
  </node>
</launch>
